üê≥ Docker Compose: Nginx, Node.js API —Ç–∞ MySQL

–¶–µ–π –ø—Ä–æ—î–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –∫–ª–∞—Å–∏—á–Ω—É –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏:

Nginx (nginxtest): –ó–≤–æ—Ä–æ—Ç–Ω–∏–π –ø—Ä–æ–∫—Å—ñ —Ç–∞ —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤.

Node.js (nodetest): –°–µ—Ä–≤–µ—Ä –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ —Ç–∞ API (–ø–æ—Ä—Ç 3000).

MySQL (mysql): –°–µ—Ä–≤–µ—Ä –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –æ–±—Ä–∞–∑ 5.7).

üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ—î–∫—Ç—É

–î–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –ø—Ä–æ—î–∫—Ç—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤ —É –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó:

.
‚îú‚îÄ‚îÄ app-files/
‚îÇ   ‚îú‚îÄ‚îÄ server.js               # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª Node.js API
‚îÇ   ‚îú‚îÄ‚îÄ package.json            # –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ Node.js (–ø–æ–≤–∏–Ω–µ–Ω –≤–∫–ª—é—á–∞—Ç–∏ 'mysql2')
‚îÇ   ‚îî‚îÄ‚îÄ static-files/           # –°—Ç–∞—Ç–∏—á–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (HTML, CSS, –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π JS)
‚îÇ       ‚îú‚îÄ‚îÄ index.html
‚îÇ       ‚îú‚îÄ‚îÄ style.css
‚îÇ       ‚îî‚îÄ‚îÄ client-logic.js
‚îú‚îÄ‚îÄ docker-compose.yml          # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Docker
‚îú‚îÄ‚îÄ Dockerfile                  # –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑–±—ñ—Ä–∫–∏ –¥–ª—è Node.js
‚îú‚îÄ‚îÄ .env                        # –§–∞–π–ª —ñ–∑ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ 

‚îú‚îÄ‚îÄ nginxconf/
‚îÇ   ‚îî‚îÄ‚îÄ default.conf            # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Nginx (–ø—Ä–æ–∫—Å—ñ —Ç–∞ —Å—Ç–∞—Ç–∏–∫–∞)
‚îî‚îÄ‚îÄ init.sql                    # SQL-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó DB


‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ó–∞–ø—É—Å–∫

1. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –°–µ—Ä–µ–¥–æ–≤–∏—â–∞ (.env)

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª .env —É –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ—î–∫—Ç—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —à–∞–±–ª–æ–Ω .env.example, —Ç–∞ –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –π–æ–≥–æ:

# ===============================================
# .env file (–°–µ–∫—Ä–µ—Ç–∏ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è)
# ===============================================

# [1] –ó–º—ñ–Ω–Ω—ñ –¥–ª—è Node.js (–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ DB)
DB_HOST=mysql
DB_USER=node_user
DB_PASSWORD=user123           # –ü–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ó–º—ñ–Ω—ñ—Ç—å!)
MY_DB=node_db                 # –ù–∞–∑–≤–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

# [2] –ü–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (root) –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó MySQL
MYSQL_ROOT_PASSWORD=root123   # –ü–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ó–º—ñ–Ω—ñ—Ç—å!)


2. –ó–∞–ø—É—Å–∫ –ü—Ä–æ—î–∫—Ç—É

–í–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –∑–±—ñ—Ä–∫–∏ –æ–±—Ä–∞–∑—ñ–≤, –∑–∞–ø—É—Å–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–µ—Ä–µ–∂:

docker-compose up --build


3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–î–æ—Å—Ç—É–ø –¥–æ –ø—Ä–æ–≥—Ä–∞–º–∏: –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∑–∞ –∞–¥—Ä–µ—Å–æ—é http://localhost:81/ (–∞–±–æ http://<IP-–∞–¥—Ä–µ—Å–∞_—Ö–æ—Å—Ç–∞>:81/).

API-—Ç–µ—Å—Ç: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API-–º–∞—Ä—à—Ä—É—Ç–∏:

/api/message: –¢–µ—Å—Ç Node.js (–æ—á—ñ–∫—É—î—Ç—å—Å—è JSON-–≤—ñ–¥–ø–æ–≤—ñ–¥—å).

/api/test-db: –¢–µ—Å—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Node.js –¥–æ MySQL (–ø–µ—Ä–µ–≤—ñ—Ä—è—î test_messages —Ç–∞–±–ª–∏—Ü—é).

üß≠ –î–µ—Ç–∞–ª—ñ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ç–∞ –ó–≤'—è–∑–∫–∏

1. –ú–µ—Ä–µ–∂–µ–≤–∞ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

frontend_net: –ó'—î–¥–Ω—É—î nginx —Ç–∞ node. Nginx –ø—Ä–æ–∫—Å—É—î —Ç—Ä–∞—Ñ—ñ–∫ API (http://node:3000) —á–µ—Ä–µ–∑ —Ü—é –º–µ—Ä–µ–∂—É.

backend_net: –ó'—î–¥–Ω—É—î node —Ç–∞ mysql. –Ü–∑–æ–ª—é—î –±–∞–∑—É –¥–∞–Ω–∏—Ö –≤—ñ–¥ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø—É Nginx.

2. –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ Healthchecks

node: –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ mysql: service_healthy. –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ Node.js –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è —ñ –Ω–µ —Å–ø—Ä–æ–±—É—î –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–æ —Ç–æ–≥–æ, —è–∫ –≤–æ–Ω–∞ –±—É–¥–µ –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Ç–∞ –≥–æ—Ç–æ–≤–∞.

nginx: –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ node: service_healthy. –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ Nginx –Ω–µ –ø–æ—á–Ω–µ –ø—Ä–æ–∫—Å—É–≤–∞—Ç–∏ —Ç—Ä–∞—Ñ—ñ–∫, –¥–æ–∫–∏ Node.js –Ω–µ –ø—Ä–æ–π–¥–µ —Å–≤–æ—é –≤–Ω—É—Ç—Ä—ñ—à–Ω—é –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∑–¥–æ—Ä–æ–≤'—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Å–ª—É—Ö–∞–Ω–Ω—è –ø–æ—Ä—Ç—É —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ DB).
